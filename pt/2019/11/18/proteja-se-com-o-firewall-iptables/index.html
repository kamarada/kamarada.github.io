<!DOCTYPE html>
<html lang="pt" prefix="
    addthis: http://www.addthis.com/help/api-spec
    og: http://ogp.me/ns#
    fb: http://ogp.me/ns/fb#
    article: http://ogp.me/ns/article#">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
        <script type="text/javascript">
            if (("kamarada.github.io" == window.location.host) && (window.location.protocol != "https:")) {
                window.location = window.location.toString().replace(/^http:/, "https:");
            }
        </script>
    

    <title>
        
            
                Proteja-se com o firewall iptables - Linux Kamarada
            
        
    </title>
    <meta name="author" content="Antônio Vinícius">
    <meta name="description" content="Faz tempo que não falamos de servidores… Hoje vamos falar sobre segurança focando em servidores, mas serve também para desktops, seja em casa ou no trabalho....">
    <link rel="canonical" href="https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/">
    <link rel="alternate" type="application/rss+xml" title="Linux Kamarada" href="https://kamarada.github.io/pt/feed.xml" />

    
    
        
            <link rel="alternate" hreflang="en" href="https://kamarada.github.io/en/2019/11/24/protect-yourself-with-the-iptables-firewall/" />
        
    
        
    

    <!-- OpenSearch -->
    <link rel="search" type="application/opensearchdescription+xml" title="Pesquisar Linux Kamarada" href="https://kamarada.github.io/pt/opensearch.xml" />

    <!-- Open Graph -->
    
        <meta property="article:published_time" content="2019-11-18 20:45:00 -0300"/>
        
            <meta property="article:publisher" content="https://facebook.com/LinuxKamarada" />
        
    
    
        <meta property="fb:app_id" content="2998145206923971" />
    
    
        <meta property="fb:page_id" content="1700979763454346" />
    
    <meta property="og:description" content="Faz tempo que não falamos de servidores… Hoje vamos falar sobre segurança focando em servidores, mas serve também para desktops, seja em casa ou no trabalho...." />
    
        <meta property="og:image" content="https://kamarada.github.io/files/2019/11/iptables.jpg" />
    
    <meta property="og:site_name" content="Linux Kamarada" />
    <meta property="og:title" content="Proteja-se com o firewall iptables" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@LinuxKamarada" />
    

    <!-- Favicons (made with RealFaviconGenerator.net) -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://kamarada.github.io/apple-touch-icon.png?v=5">
    <link rel="icon" type="image/png" sizes="32x32" href="https://kamarada.github.io/favicon-32x32.png?v=5">
    <link rel="icon" type="image/png" sizes="16x16" href="https://kamarada.github.io/favicon-16x16.png?v=5">
    <link rel="manifest" href="https://kamarada.github.io/site.webmanifest?v=5">
    <link rel="mask-icon" href="https://kamarada.github.io/safari-pinned-tab.svg?v=5" color="#43a047">
    <link rel="shortcut icon" href="https://kamarada.github.io/favicon.ico?v=5">
    <meta name="msapplication-TileColor" content="#43a047">
    <meta name="theme-color" content="#43a047">

    <!-- CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    
        <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
        <!--<link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.2/dist/css/bootstrap-material-design.min.css" integrity="sha384-dI6l3oYG+wVvjfdlixt6+FMddrb9+uejLU/wMhQFKklk7RDtSDBfe/XuF1dkcgVV" crossorigin="anonymous">-->
        <link rel="stylesheet" href="/libs/bootstrap-material-design/4.1.2/custom/bootstrap-material-design.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- JS -->
    
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha256-x3YZWtRjM8bJqf48dFAv/qmgL68SI4jqNWeSLMZaMGA=" crossorigin="anonymous"></script>
        <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>-->
        <script src="https://unpkg.com/bootstrap-material-design@4.1.2/dist/js/bootstrap-material-design.min.js" integrity="sha384-aWO+CcMRDQLEvnT8RdnCxWbs4C76Ryoo4pzYpGNW2vlHTHiPA7gpBzIB5nYwYfLg" crossorigin="anonymous"></script>
        <script src="/assets/js/adsbygoogle.js"></script>
    
    <script src="/assets/js/main.js"></script>

    
        <!-- Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-65333685-3"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-65333685-3');
        </script>
        <!-- End Google Analytics -->
    

    
        <!-- Google AdSense -->
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    

    
        
            <!-- AddThis -->
            <script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-563f92aa117815bd"></script>
            <script type="text/javascript">
                var addthis_config = {
                    data_track_clickback: true,
                    data_track_addressbar: true,
                    
                        ui_language: 'pt'
                    
                };
                var addthis_share = {
                    url: 'https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/',
                    title: document.title,
                    description: 'Faz tempo que não falamos de servidores… Hoje vamos falar sobre segurança focando em servidores, mas serve também para desktops, seja em casa ou no trabalho....'
                };
            </script>
            <!-- End AddThis -->
        
    
</head>


<body itemscope itemtype="http://schema.org/BlogPosting">
    
        <!-- Facebook SDK -->
        <div id="fb-root"></div>
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v4.0&appId=&autoLogAppEvents=1"></script>
        <!-- End Facebook SDK -->
    

    <div class="bmd-layout-container bmd-drawer-f-l bmd-drawer-overlay">
        <!-- Fixed navbar -->
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary">
    <div class="container">
        <button type="button" class="navbar-toggler" data-toggle="drawer" data-target="#drawer">
            <span class="sr-only">
                
                    Exibir/esconder navegação
                
            </span>
            <i class="material-icons">menu</i>
        </button>

        <a class="navbar-brand" href="/">
            
                Linux Kamarada
            
        </a>

        <div class="collapse navbar-collapse" id="navbar">
            <ul class="navbar-nav m-auto">
                

                
                    
                        <li class="nav-item">
                            <a class="nav-link" href="/pt/download">Download</a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="nav-link" href="/pt/ajuda">Ajuda</a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="nav-link" href="/pt/contribuir">Contribuir</a>
                        </li>
                    
                
            </ul>
            <form action="/pt/buscar/" class="form-inline search-form" id="navbar-search-form" method="get" role="search">
                
                
                <div class="input-group">
                    <input class="form-control search-field" id="navbar-search-field" name="q" placeholder="Pesquisar" type="text" aria-label="Pesquisar">
                    <div class="input-group-append">
                        <button class="btn btn-secondary btn-number search-button" id="navbar-search-button" type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="dropdown">
                    <a class="dropdown-toggle" id="navbar-language-button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Traduções" href="#" role="button"><i class="fas fa-globe-americas" aria-hidden="true"></i></a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbar-language-button">
                        
                        
                            <h6 class="dropdown-header">English</h6>
                            
                            
                                <a class="dropdown-item translation-en" href="https://kamarada.github.io/en/2019/11/24/protect-yourself-with-the-iptables-firewall/">This page in English</a>
                            
                            <a class="dropdown-item" href="https://kamarada.github.io/en/">English home page</a>
                            <div class="dropdown-divider"></div>
                        
                            <h6 class="dropdown-header">Português</h6>
                            
                            
                                <a class="dropdown-item translation-pt" href="https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/">Esta página em Português</a>
                            
                            <a class="dropdown-item" href="https://kamarada.github.io/pt/">Página inicial em Português</a>
                            <div class="dropdown-divider"></div>
                        
                        <h6 class="dropdown-header">Other languages (by Google Translate)</h6>
                        <a class="dropdown-item" href="http://translate.google.com/translate?js=n&sl=pt&u=https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/">Translate this page</a>
                    </div>
                </div><!--.dropdown-->
            </form>
        </div><!--#navbar-->
    </div><!--.container-->
</nav>

        <!-- Navigation drawer -->
<div id="drawer" class="bmd-layout-drawer bg-faded">
    <header>
        <a class="navbar-brand" href="/">
            
                Linux Kamarada
            
        </a>
    </header>
    <form action="/pt/buscar/" class="form-inline border-top" id="drawer-search-form" method="get" role="search">
        
        
        <div class="bmd-form-group-sm">
            <div class="input-group">
                <input class="form-control search-field" id="drawer-search-field" name="q" placeholder="Pesquisar" type="text" aria-label="Pesquisar">
                <div class="input-group-append">
                    <button class="btn btn-secondary btn-number search-button" id="drawer-search-button" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div><!-- .input-group -->
        </div><!-- .bmd-form-group-sm -->
    </form>
    <ul class="list-group list-group-flush border-top" id="drawer-links">
        

        
            
                <li class="nav-item">
                    <a class="nav-link" href="/pt/download">Download</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/pt/ajuda">Ajuda</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/pt/contribuir">Contribuir</a>
                </li>
            
        
    </ul>

    <div class="btn-group mb-3 mt-3">
        <button type="button" class="btn btn-secondary" id="drawer-language-button">
            <i class="fas fa-globe-americas" aria-hidden="true"></i> Português
        </button>
    </div>
</div><!--.drawer-->


        <main class="bmd-layout-content">
            <div class="container" id="main-container">
                <div class="row">
                    <div class='col-sm-8'>
                        <!--<div class='gap-small'>
                            <a href='http://en.opensuse.org/Portal:15.2'>
                                <img class='img-fluid' id='countdown' src='http://countdown.opensuse.org/wide.pt.png'/>
                            </a>
                        </div>-->
                        <div class="blog-post card mb-3">
    <header class="card-header">
        <h1 class="blog-post-title" itemprop="headline name">
            <a class="blog-post-link" href="/pt/2019/11/18/proteja-se-com-o-firewall-iptables/" itemprop="mainEntityOfPage url">
                Proteja-se com o firewall iptables
            </a>
        </h1>
        <div class="blog-post-meta row">
            <div class='col-sm-6'>
                <p class="blog-post-date" itemprop="datePublished" content="2019-11-18">
                    <a href="/2019/11/18/">
                        
    18 de
    
    Novembro
        
    de 2019


                    </a>
                </p>
                <meta itemprop="dateModified" content="2020-03-29" />
            </div>
            <div class='col-sm-6'>
                
                    <div class='blog-post-share'>
                        <!-- AddThis Sharing Buttons -->
                        <div class="addthis_toolbox addthis_default_style">
                            <a class="addthis_button_facebook"></a>
                            <a class="addthis_button_twitter" data-via="LinuxKamarada"></a>
                            <a class="addthis_button_telegram"></a>
                            <a class="addthis_button_favorites"></a>
                            <a class="addthis_button_compact"></a>
                            <a class="addthis_counter addthis_bubble_style"></a>
                        </div>
                        <!-- AddThis Sharing Buttons End -->
                    </div><!-- .blog-post-share -->
                
            </div><!-- .col-sm-6 -->
        </div><!-- .blog-post-meta -->
    </header>

    <article class="blog-post-content card-body">
        
            
    <!-- Google AdSense -->
    <ins class="adsbygoogle" id="content_ad_unit_1"
        style="display:block"
        data-ad-client="ca-pub-5193467168351289"
        data-ad-slot="8945658251"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <!-- End Google AdSense -->
    <div class="alert alert-danger please-allow-ads d-none" role="alert">
        <div class="media">
            <img class="mr-3" src="/assets/icons/other/detective_penguin.svg" alt="Detetive pinguim" style="max-width: 64px;">
            <div class="media-body">
                <h6 class="alert-heading mt-0">Cadê o anúncio que estava aqui?</h6>
                Parece que você está usando um bloqueador de anúncios. Mas dependemos deles para continuar criando conteúdo gratuito e de qualidade para você. Se você gosta do nosso conteúdo, por favor apoie nosso <em>site</em> desativando seu bloqueador de anúncios. Alternativamente, se você vem aqui com frequência, por favor considere <a href='/pt/contribuir'>fazer uma doação</a>.
            </div>
        </div>
    </div>


        

        <div itemprop="articleBody mainEntity">
            <p>Faz tempo que não falamos de servidores… Hoje vamos falar sobre <strong>segurança</strong> focando em servidores, mas serve também para <em>desktops</em>, seja em casa ou no trabalho. A Internet facilitou bastante acessar, enviar e compartilhar informações. Mas, como diz o ditado, “não há bônus sem ônus”: junto das conveniências, a Internet trouxe também uma série de riscos e ameaças. Uma das soluções usadas para tentar prevenir ataques e invasões é o <em>firewall</em>.</p>

<p>O <strong><em>firewall</em></strong> (“parede de fogo”, em inglês) é um <em>software</em> que monitora os pacotes que trafegam entrando e saindo da rede e permite ou bloqueia pacotes específicos com base em regras de segurança predefinidas.</p>

<div class="image no-ads-here text-center mb-3" itemscope="" itemtype="http://schema.org/ImageObject">
<a href="/files/2019/11/iptables.jpg" title="">
<img src="/files/2019/11/iptables.jpg" alt="" class="img-fluid img-thumbnail" itemprop="contentUrl" />
</a>

</div>

<p>Se você entende melhor usando analogias, pense no <em>firewall</em> como o segurança de uma festa: ele confere o documento das pessoas que chegam e permite que entrem ou não com base em uma lista de convidados.</p>

<p>Também existem <em>firewalls</em> na forma de <em>hardware</em>, ou soluções mistas de <em>hardware</em> e <em>software</em>, mas comumente o <em>firewall</em> é um <em>software</em> instalado em um servidor ou <em>desktop</em>.</p>

<p><em>Firewalls</em> podem ser instalados em diversos lugares com diferentes finalidades, como:</p>

<ul>
  <li>no servidor (por exemplo, um servidor <em>web</em>) ou no <em>desktop</em> (por exemplo, uma estação de trabalho), para proteger o próprio servidor ou <em>desktop</em>;</li>
  <li>no servidor inserido entre a rede local e a Internet, para proteger a rede local; ou</li>
  <li>no servidor que faz roteamento entre diversas redes internas, para protegê-las.</li>
</ul>

<div class="image no-ads-here text-center mb-3" itemscope="" itemtype="http://schema.org/ImageObject">
<a href="/files/2019/11/firewall-places.jpg" title="">
<img src="/files/2019/11/firewall-places.jpg" alt="" class="img-fluid img-thumbnail" itemprop="contentUrl" />
</a>

</div>

<p>Com base na camada do <a href="https://pt.wikipedia.org/wiki/TCP/IP">modelo TCP/IP</a> em que atuam, <em>firewalls</em> podem ser classificados em:</p>

<ul>
  <li><strong>filtro de pacotes</strong> (<em>packet filter</em>): atua nas camadas 2 (rede) e 3 (transporte), permite ou bloqueia pacotes com base em suas características (endereço/porta/interface de origem/destino, protocolo usado — se é TCP, UDP, ICMP, etc). É o tipo de <em>firewall</em> mais antigo, simples e limitado, mas já oferece um nível de segurança significativo.</li>
  <li><strong><em>firewall</em> de aplicação</strong>, mais conhecido como <strong><em><a href="https://pt.wikipedia.org/wiki/Proxy">proxy</a></em></strong>: atua na camada 4 (aplicação) e é capaz de bloquear pacotes com base em seu conteúdo. Por exemplo, um <em>proxy</em> HTTP consegue bloquear o acesso a uma página se ela contiver determinada palavra no <em>link</em>, ou se ela é conhecida por apresentar pirataria, jogo, pornografia, <em>malware</em>, etc.</li>
</ul>

<h2 id="como-é-o-firewall-no-linux">Como é o firewall no Linux</h2>

<p>No <a href="https://www.vivaolinux.com.br/linux/">Linux</a>, o <em>firewall</em> está inserido dentro do <em><a href="https://www.kernel.org/">kernel</a></em> (núcleo do sistema) na forma de um módulo chamado <code class="highlighter-rouge">ip_tables</code>. Para configura-lo, usamos a ferramenta de linha de comando <strong><a href="https://netfilter.org/projects/iptables/">iptables</a></strong>.</p>

<p>Normalmente, as pessoas simplificam e chamam tanto o módulo do <em>kernel</em> quanto a ferramenta de <strong>iptables</strong>, como se fossem a mesma coisa. Vamos fazer assim.</p>

<p>O <strong>iptables</strong> é, a princípio, um <em>firewall</em> em nível de pacotes, mas dispõe de módulos que o permitem atuar na camada de aplicação. Ele vem instalado por padrão na maioria das distribuições Linux, incluindo o <a href="/pt/2019/09/13/primeira-versao-beta-da-distribuicao-linux-kamarada/">Linux Kamarada</a> e o <a href="https://www.opensuse.org/">openSUSE</a>. Isso significa que podemos simplesmente começar a usar o <strong>iptables</strong>: não precisamos instalar nada antes.</p>

<p>A versão original do módulo <code class="highlighter-rouge">ip_tables</code> e da ferramenta <strong>iptables</strong> lida apenas com IPv4. Existem também os análogos <code class="highlighter-rouge">ip6_tables</code> e <strong><a href="https://linux.die.net/man/8/ip6tables">ip6tables</a></strong> para lidar com IPv6.</p>

<p>Muitas distribuições trazem ferramentas alternativas para configurar o <em>firewall</em>, como o <strong><a href="https://firewalld.org/">firewalld</a></strong>, que pode ser usado tanto pela linha de comando quanto pela interface gráfica (que algumas pessoas podem achar mais fácil de usar). Por padrão, o openSUSE vem com o <strong>iptables</strong> e o <strong>firewalld</strong> quando instalado em <em>desktops</em>, mas apenas com o <strong>iptables</strong> (sem o <strong>firewalld</strong>) quando instalado em servidores. O Linux Kamarada, que é focado em <em>desktops</em> e usuários iniciantes de Linux, também traz o <strong>iptables</strong> e o <strong>firewalld</strong> instalados por padrão.</p>

<p>Hoje, vamos falar apenas do <strong>iptables</strong>. Oportunamente, podemos falar do <strong>firewalld</strong>, mas já mencionamos ele em um <em>post</em>, se você quiser ter uma ideia de como é a tela dele, veja:</p>

<ul>
  <li><a href="/pt/2019/03/26/transmitindo-do-linux-para-a-tv-com-chromecast/">Transmitindo do Linux para a TV com Chromecast</a></li>
</ul>

<h2 id="conceitos-básicos">Conceitos básicos</h2>

<p>Para entender o funcionamento do <strong>iptables</strong>, você precisa saber o que são regras, <em>chains</em>, tabelas, <em>targets</em> e política padrão.</p>

<p>As <strong>regras</strong> descrevem tipos de pacotes (endereço/porta/interface de origem/destino, protocolo usado, etc.) e o que fazer com esses pacotes (como bloquear ou deixar passar).</p>

<p>Uma <strong><em>chain</em></strong> é uma lista de regras (traduções possíveis seriam cadeia, corrente, sequência, algo nesse sentido, mas comumente se usa o termo em inglês mesmo). O <strong>iptables</strong> possui <em>chains</em> predefinidas e o usuário também pode criar as suas próprias <em>chains</em>.</p>

<p>Já as <strong>tabelas</strong> são conjuntos de <em>chains</em>. O <strong>iptables</strong> tem 4 tabelas que são usadas em diferentes momentos, apresentadas a seguir: <code class="highlighter-rouge">filter</code>, <code class="highlighter-rouge">nat</code>, <code class="highlighter-rouge">mangle</code> e <code class="highlighter-rouge">raw</code>. Cada tabela contém <em>chains</em> predefinidas do <strong>iptables</strong> e pode conter também <em>chains</em> criadas pelo usuário. Hoje, vamos focar na tabela <code class="highlighter-rouge">filter</code>. Oportunamente, podemos falar mais sobre as outras tabelas.</p>

<ul>
  <li><code class="highlighter-rouge">filter</code>: essa é a tabela usada por padrão, contém 3 <em>chains</em> predefinidas do <strong>iptables</strong>:
    <ul>
      <li><code class="highlighter-rouge">INPUT</code>: consultada quando pacotes chegam à máquina</li>
      <li><code class="highlighter-rouge">OUTPUT</code>: consultada quando pacotes devem sair da máquina</li>
      <li><code class="highlighter-rouge">FORWARD</code>: consultada quando pacotes devem ser roteados através da máquina (encaminhados de uma interface de rede para outra ou de uma máquina para outra, passando pela máquina atual)</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">nat</code>: essa tabela é usada para fazer <a href="https://pt.wikipedia.org/wiki/Network_address_translation">NAT</a> (<em>Network Address Translation</em>), contém 3 <em>chains</em> predefinidas do <strong>iptables</strong>: <code class="highlighter-rouge">PREROUTING</code>, <code class="highlighter-rouge">OUTPUT</code> e <code class="highlighter-rouge">POSTROUTING</code></li>
  <li><code class="highlighter-rouge">mangle</code>: essa tabela é usada para fazer alterações específicas em pacotes, como, por exemplo, modificar o tipo de serviço (<a href="https://pt.wikipedia.org/wiki/ToS">ToS</a>), contém 5 <em>chains</em> predefinidas do <strong>iptables</strong>: <code class="highlighter-rouge">PREROUTING</code>, <code class="highlighter-rouge">OUTPUT</code>, <code class="highlighter-rouge">INPUT</code>, <code class="highlighter-rouge">FORWARD</code> e <code class="highlighter-rouge">POSTROUTING</code></li>
  <li><code class="highlighter-rouge">raw</code>: essa tabela é consultada pelo <strong>iptables</strong> antes das demais e é usada principalmente para dispensar pacotes do rastreamento de conexão, contém 2 <em>chains</em> predefinidas do <strong>iptables</strong>: <code class="highlighter-rouge">PREROUTING</code> e <code class="highlighter-rouge">OUTPUT</code>.</li>
</ul>

<p>Note que os nomes das <em>chains</em> são sensíveis à capitalização (<em>case sensitive</em>). Portanto, <code class="highlighter-rouge">INPUT</code>, <code class="highlighter-rouge">input</code> e <code class="highlighter-rouge">Input</code>, por exemplo, seriam 3 <em>chains</em> diferentes. As <em>chains</em> predefinidas do <strong>iptables</strong> são sempre escritas em caixa alta (por exemplo, <code class="highlighter-rouge">INPUT</code>).</p>

<p>Quando recebe um pacote, o <strong>iptables</strong> analisa as regras buscando uma regra que descreva aquele pacote. As regras são analisadas na ordem em que foram inseridas na <em>chain</em>. Quando o <strong>iptables</strong> analisa uma regra, se o pacote não corresponde à descrição, ele passa para a próxima regra. Se o pacote corresponde, então o <strong>iptables</strong> verifica na regra para onde enviar o pacote, que é o <strong><em>target</em></strong> (alvo).</p>

<p>O <em>target</em> pode ser o nome de uma <em>chain</em> do usuário — nesse caso, o <strong>iptables</strong> vai continuar analisando as regras dessa <em>chain</em> — ou pode ser um desses valores especiais, diante dos quais o <strong>iptables</strong> para de analisar as regras da <em>chain</em> atual e age sobre o pacote imediatamente:</p>

<ul>
  <li><code class="highlighter-rouge">ACCEPT</code>: aceitar o pacote, deixá-lo (permiti-lo) passar</li>
  <li><code class="highlighter-rouge">DROP</code>: descartar (excluir, ignorar) o pacote — na prática, significa impedi-lo de passar</li>
  <li><code class="highlighter-rouge">QUEUE</code>: passar o pacote para um programa do espaço de usuário (fora do <em>kernel</em>), que irá processar o pacote</li>
  <li><code class="highlighter-rouge">RETURN</code>: interrompe o processamento das regras da <em>chain</em> atual e retorna o processamento das regras para a regra seguinte na <em>chain</em> anterior (a que chamou a <em>chain</em> atual)</li>
</ul>

<p>Por fim, se o <strong>iptables</strong> já analisou todas as regras da <em>chain</em> e não encontrou uma regra que descreve o pacote, ele vai adotar a <strong>política padrão</strong> predefinida para aquela <em>chain</em>, que pode ser somente um dos quatro <em>targets</em> especiais acima.</p>

<p>Há ainda o <em>target</em> <code class="highlighter-rouge">REJECT</code>, que é semelhante ao <code class="highlighter-rouge">DROP</code>, mas só pode ser usado em regras das <em>chains</em> da tabela <code class="highlighter-rouge">filter</code>. Falaremos mais sobre o <em>target</em> <code class="highlighter-rouge">REJECT</code> adiante.</p>

<p>Parece confuso? Não se preocupe: vamos meter a mão na massa e tudo vai ficar mais claro.</p>

<h2 id="listando-as-regras-em-uso">Listando as regras em uso</h2>

<p>Será que nosso <em>firewall</em> já possui regras antes mesmo de adicionarmos nossa primeira regra? Vejamos!</p>

<p>Para listar as regras atualmente em uso pelo <strong>iptables</strong>, execute o comando a seguir:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -L
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Adianto que hoje só usaremos a interface de linha de comando e praticamente todos os comandos serão executados como administrador (usuário <em>root</em>). Suponho que você já possua certa familiaridade com o Linux e com o <a href="https://kamarada.github.io/guiadoopensuse/terminal">terminal</a>.</p>

<p>A saída do comando acima deve ser algo parecido com:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Essa é a configuração padrão do <strong>iptables</strong>: a política padrão (<em>policy</em>) de todas as <em>chains</em> é aceitar (<code class="highlighter-rouge">ACCEPT</code>) e elas não possuem regras de antemão. Ou seja, qualquer pacote que deseja entrar no sistema ou sair dele, o <strong>iptables</strong> deixa passar.</p>

<p>Se a saída para você é diferente, é possível que o administrador já tenha adicionado regras, que a distribuição que você usa tenha outra configuração padrão, ou que você esteja usando o <strong>firewalld</strong>, que cria suas próprias <em>chains</em>. A seguir, veremos como excluir essas regras.</p>

<p>Por padrão, são listadas as regras da tabela <code class="highlighter-rouge">filter</code>. Para listar as regras de outra tabela, adicione o parâmetro <code class="highlighter-rouge">-t</code> (ou <code class="highlighter-rouge">--table</code>) seguido do nome da tabela. Por exemplo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre># iptables -t nat -L
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Caso você queira limitar a exibição a uma <em>chain</em>, informe o seu nome no final. Exemplo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># iptables -t mangle -L FORWARD
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="excluindo-todas-as-regras-em-uso">Excluindo todas as regras em uso</h2>

<p>Como a ordem das regras importa para o <strong>iptables</strong>, é comum iniciar sua configuração excluindo quaisquer regras que estejam em uso.</p>

<div class="alert alert-danger" role="alert">

<p><strong>Não</strong> teste os comandos desse tutorial em um servidor que você acessa remotamente via SSH: você corre o risco de perder o acesso ao servidor.</p>

</div>

<div class="alert alert-info" role="alert">

<p>Para acompanhar este tutorial, recomendo que você use uma máquina virtual. Com isso, você não modifica as configurações do seu servidor ou <em>desktop</em>.</p>

<p>Para mais informações, leia:</p>

<ul>
  <li><a href="/pt/2019/10/08/virtualbox-a-forma-mais-facil-de-conhecer-o-linux-sem-precisar-instala-lo/">VirtualBox: a forma mais fácil de conhecer o Linux sem precisar instalá-lo</a></li>
</ul>

</div>

<p>Para excluir todas as regras, use o comando:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -F
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Na verdade, por padrão, são excluídas as regras de todas as <em>chains</em> da tabela <code class="highlighter-rouge">filter</code>.</p>

<p>Nesse sentido, o comando <code class="highlighter-rouge">iptables -F</code> é semelhante ao comando <code class="highlighter-rouge">iptables -L</code>:</p>

<ul>
  <li>para excluir as regras de outra tabela, adicione o parâmetro <code class="highlighter-rouge">-t</code> seguido do nome da tabela, e</li>
  <li>para excluir as regras apenas de uma <em>chain</em> específica, adicione seu nome ao final.</li>
</ul>

<p>Exemplos:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># iptables -t nat -F
# iptables -t mangle -F POSTROUTING

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="excluindo-todas-as-chains-do-usuário">Excluindo todas as chains do usuário</h2>

<p>Além de excluir as regras, também é comum iniciar excluindo as <em>chains</em> do usuário.</p>

<p>Para excluir todas as <em>chains</em> do usuário presentes na tabela <code class="highlighter-rouge">filter</code>, use o comando:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -X
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ainda que você mesmo não tenha criado nenhuma <em>chain</em>, se sua distribuição usa o <strong>firewalld</strong>, com esse comando você exclui as <em>chains</em> criadas pelo <strong>firewalld</strong>.</p>

<p>Da mesma forma, para especificar uma tabela, use o parâmetro <code class="highlighter-rouge">-t</code>, e para excluir apenas uma <em>chain</em> específica, adicione seu nome ao final.</p>

<p>Note que não é possível excluir as <em>chains</em> do <strong>iptables</strong>, apenas as do usuário.</p>

<p>Resumindo, para fazer uma limpeza completa no <strong>iptables</strong>, execute os comandos:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre># iptables -F
# iptables -X
# iptables -t nat -F
# iptables -t nat -X
# iptables -t mangle -F
# iptables -t mangle -X
# iptables -t raw -F
# iptables -t raw -X
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Depois dessa limpeza, se você listar as regras (<code class="highlighter-rouge">iptables -L</code>), certamente verá a configuração padrão do <strong>iptables</strong>.</p>

<h2 id="adicionando-regras">Adicionando regras</h2>

<p>Agora sim vamos à parte mais interessante: vamos adicionar nossa primeira regra ao <strong>iptables</strong>. Como exemplo, vamos adicionar uma regra que bloqueia o acesso à própria máquina (<code class="highlighter-rouge">127.0.0.1</code> ou <code class="highlighter-rouge">localhost</code>).</p>

<p>Antes, execute um <strong><a href="https://linux.die.net/man/8/ping">ping</a></strong> e certifique-se de que funciona (use <strong>Ctrl + C</strong> para interrompê-lo):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>$ ping 127.0.0.1
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.036 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.106 ms
^C
--- 127.0.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1010ms
rtt min/avg/max/mdev = 0.036/0.071/0.106/0.035 ms
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Agora, adicione a regra:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -d 127.0.0.1 -j DROP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Leiamos esse comando por partes:</p>

<ul>
  <li>como nos comandos anteriores, poderíamos usar o parâmetro <code class="highlighter-rouge">-t</code> para especificar uma tabela, como não fizemos isso, usamos a tabela <code class="highlighter-rouge">filter</code> por padrão</li>
  <li>o parâmetro <code class="highlighter-rouge">-A</code> inicia a adição de uma nova regra ao final da <em>chain</em></li>
  <li><code class="highlighter-rouge">INPUT</code> é a <em>chain</em> onde a regra está sendo adicionada — nesse caso, estamos interessados nos pacotes que chegam à máquina</li>
  <li>o parâmetro <code class="highlighter-rouge">-d</code> (poderia ser também <code class="highlighter-rouge">--dst</code> ou <code class="highlighter-rouge">--destination</code>) indica o destino — nesse caso, filtramos pacotes com destino a <code class="highlighter-rouge">127.0.0.1</code> (a própria máquina)</li>
  <li>o parâmetro <code class="highlighter-rouge">-j</code> (poderia ser também <code class="highlighter-rouge">--jump</code>) indica o que fazer com o pacote (o <em>target</em>) — nesse caso, descartar (<code class="highlighter-rouge">DROP</code>)</li>
</ul>

<p>Agora, depois de adicionada a regra, tente novamente usar o <strong>ping</strong>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$ ping 127.0.0.1
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
^C
--- 127.0.0.1 ping statistics ---
2 packets transmitted, 0 received, 100% packet loss, time 1006ms
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Viu só? Não funcionou. O <strong>iptables</strong> está bloqueando esses pacotes com base na regra que acabamos de adicionar.</p>

<div class="alert alert-warning" role="alert">

<p><strong>Observação:</strong> a regra acima foi usada apenas para fins didáticos. Nunca bloqueie o acesso à própria máquina, a menos que saiba o que está fazendo, pois muitos aplicativos utilizam soquetes TCP para realizar conexões.</p>

</div>

<p>Dito isso, vamos desfazer a adição da regra acima antes de continuar:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -F
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="definindo-a-política-padrão-de-uma-chain">Definindo a política padrão de uma chain</h2>

<p>Entre a limpeza das tabelas e a adição das regras propriamente ditas, eu costumo definir a política padrão das <em>chains</em>. Usando o comando <code class="highlighter-rouge">iptables -L</code>, vimos que a configuração padrão do <strong>iptables</strong> é permitir todo o tráfego em todas as <em>chains</em> (política padrão de <code class="highlighter-rouge">ACCEPT</code>).</p>

<p>Normalmente, quando adotamos uma política padrão permissiva (<code class="highlighter-rouge">ACCEPT</code>) para uma <em>chain</em>, adicionamos regras restritivas (<code class="highlighter-rouge">DROP</code> ou <code class="highlighter-rouge">REJECT</code>) a essa <em>chain</em>, ou seja, as regras determinam o que bloquear, e por padrão, o que não é bloqueado, é permitido.</p>

<p>Já quando adotamos uma política padrão restritiva (<code class="highlighter-rouge">DROP</code>) para uma <em>chain</em>, adicionamos regras permissivas (<code class="highlighter-rouge">ACCEPT</code>) a essa <em>chain</em>, ou seja, as regras determinam o que permitir, e por padrão, o que não é permitido, é bloqueado.</p>

<p>Para a maioria das <em>chains</em>, uma política padrão permissiva (<code class="highlighter-rouge">ACCEPT</code>) é considerada insegura. Ao menos para a <em>chain</em> <code class="highlighter-rouge">INPUT</code>, considere usar uma política padrão restritiva (<code class="highlighter-rouge">DROP</code>). Desse modo, você só precisa permitir os serviços considerados seguros e não corre o risco de esquecer de bloquear algum acesso não desejado.</p>

<p>Para mudar a política padrão de uma <em>chain</em>, use o comando <code class="highlighter-rouge">iptables -P</code> seguido do nome da <em>chain</em> e do <em>target</em> que deve ser a política padrão. Exemplos:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># iptables -P FORWARD DROP
# iptables -P INPUT DROP
# iptables -P OUTPUT ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Se você executar os três comandos acima, talvez algo pare de funcionar. Por exemplo: o navegador não consegue acessar <em>sites</em>. Isso acontece porque, embora a requisição seja enviada (a política padrão de <code class="highlighter-rouge">OUTPUT</code> é <code class="highlighter-rouge">ACCEPT</code>), a resposta é descartada (a política padrão de <code class="highlighter-rouge">INPUT</code> é <code class="highlighter-rouge">DROP</code>). Para prevenir casos assim, eu costumo usar a seguinte regra:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Trata-se de uma “receita pronta” que eu encontrei na Internet para aceitar conexões que já foram estabelecidas previamente. Com essa regra, ao notar que o pacote que chega é uma resposta a uma requisição feita anteriormente pela própria máquina (o pacote que chega não é uma tentativa de conexão iniciada por outra máquina), o <strong>iptables</strong> aceita o pacote.</p>

<p>Note que políticas padrão são configuradas apenas para <em>chains</em> predefinidas do <strong>iptables</strong> (<em>chains</em> definidas pelo usuário não possuem política padrão).</p>

<h2 id="descrevendo-pacotes">Descrevendo pacotes</h2>

<p>Vejamos alguns parâmetros que podemos usar para descrever pacotes na hora de criar regras para o <strong>iptables</strong>, assim como exemplos de regras válidas.</p>

<div class="alert alert-warning" role="alert">

<p><strong>Observação:</strong> as regras a seguir são apenas exemplos, você não deve copiar e colar no seu servidor ou <em>desktop</em>, mas adaptar os comandos conforme a sua necessidade.</p>

</div>

<ul>
  <li><strong>destino:</strong> já vimos o parâmetro <code class="highlighter-rouge">-d</code> (ou <code class="highlighter-rouge">--dst</code>, ou <code class="highlighter-rouge">--destination</code>), que permite filtrar um pacote pelo seu destino, que pode ser expresso na forma de:
    <ul>
      <li>o endereço IP de um <em>host</em> (por exemplo, <code class="highlighter-rouge">157.240.12.35</code>);</li>
      <li>o endereço IP de uma rede/sub-rede acompanhado da máscara de rede, em notação tradicional (por exemplo, <code class="highlighter-rouge">157.240.12.0/255.255.255.0</code>) ou <a href="https://doc.m0n0.ch/quickstartpc/intro-CIDR.html">CIDR</a> (<code class="highlighter-rouge">157.240.12.0/24</code>);</li>
      <li>nome de rede (<em>hostname</em>, por exemplo, <code class="highlighter-rouge">www</code>); ou</li>
      <li>nome de domínio completo (do inglês <em>fully qualified domain name</em> ou <a href="https://pt.wikipedia.org/wiki/FQDN">FQDN</a>, por exemplo, <code class="highlighter-rouge">www.facebook.com</code>).</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A OUTPUT -d 157.240.12.35 -j REJECT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(leia-se: todos os pacotes saindo desta máquina com destino a <code class="highlighter-rouge">157.240.12.35</code> devem ser rejeitados — é um dos endereços IP de <a href="https://www.facebook.com/">www.facebook.com</a>, note que na verdade bloquear o acesso ao <a href="https://www.facebook.com/">Facebook</a> não é tão simples assim, essa regra é apenas um exemplo)</p>

<div class="alert alert-warning" role="alert">

<p><strong>Observação:</strong> embora você possa usar nomes, prefira usar endereços IP (imagine o que pode acontecer se seu servidor DNS sair do ar — ou pior, se for invadido).</p>

</div>

<ul>
  <li><strong>origem:</strong> de forma análoga, o parâmetro <code class="highlighter-rouge">-s</code> (ou <code class="highlighter-rouge">--src</code>, ou <code class="highlighter-rouge">--source</code>) permite filtrar um pacote pela sua origem, aceita os mesmos formatos do parâmetro <code class="highlighter-rouge">-d</code>.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -s 222.187.224.200 -j DROP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(todos os pacotes tentando entrar nesta máquina vindo de <code class="highlighter-rouge">222.187.224.200</code> devem ser descartados — uma vez, esse endereço IP estava tentando atacar um servidor que eu administrava, não sei se esse endereço ainda é usado para ataques)</p>

<ul>
  <li><strong>interface de origem:</strong> o parâmetro <code class="highlighter-rouge">-i</code> (ou <code class="highlighter-rouge">--in-interface</code>) permite filtrar um pacote pela interface de rede na qual ele é recebido (por exemplo, <code class="highlighter-rouge">eth0</code>).</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -i lo -j ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(todos os pacotes recebidos na <a href="https://pt.wikipedia.org/wiki/Loopback">interface de <em>loopback</em></a> — <code class="highlighter-rouge">lo</code> — devem ser aceitos)</p>

<ul>
  <li><strong>interface de destino:</strong> de forma análoga, o parâmetro <code class="highlighter-rouge">-o</code> (ou <code class="highlighter-rouge">--out-interface</code>) permite filtrar um pacote pela interface de rede pela qual ele deve ser enviado.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A FORWARD -i eth0 -o eth1 -j DROP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(descartar todos os pacotes que tentam passar da interface <code class="highlighter-rouge">eth0</code> para a interface <code class="highlighter-rouge">eth1</code>)</p>

<ul>
  <li><strong>protocolo:</strong> o parâmetro <code class="highlighter-rouge">-p</code> (ou <code class="highlighter-rouge">--protocol</code>) permite filtrar um pacote pelo protocolo (TCP, UDP ou ICMP, pode ser escrito em maiúsculas ou minúsculas).</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -p icmp -j ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(aceitar todos os pacotes do protocolo ICMP — por exemplo, <strong>ping</strong>)</p>

<ul>
  <li>
    <p><strong>porta de origem:</strong> o parâmetro <code class="highlighter-rouge">--sport</code> (ou <code class="highlighter-rouge">--source-port</code>) permite filtrar um pacote pela porta de origem, só pode ser usado após <code class="highlighter-rouge">-p tcp</code> ou <code class="highlighter-rouge">-p udp</code>.</p>
  </li>
  <li>
    <p><strong>porta de destino:</strong> o parâmetro <code class="highlighter-rouge">--dport</code> (ou <code class="highlighter-rouge">--destination-port</code>) permite filtrar um pacote pela porta de destino, só pode ser usado após <code class="highlighter-rouge">-p tcp</code> ou <code class="highlighter-rouge">-p udp</code>.</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -p tcp --dport 22 -i eth0 -j ACCEPT
# iptables -A INPUT -p udp --dport 22 -i eth0 -j ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(aceitar todas as requisições TCP e UDP para a porta 22 recebidas na interface <code class="highlighter-rouge">eth0</code> — a porta 22 é a porta usada por padrão pelo serviço SSH)</p>

<p><strong>Observação:</strong> todos os parâmetros acima aceitam negação usando exclamação (<code class="highlighter-rouge">!</code>) antes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># iptables -A INPUT -p tcp --dport 22 ! -i eth0 -j DROP
# iptables -A INPUT -p udp --dport 22 ! -i eth0 -j DROP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(descartar todas as requisições TCP e UDP para a porta 22, <strong>exceto</strong> as recebidas na interface <code class="highlighter-rouge">eth0</code>)</p>

<p>Conhecendo esses parâmetros, você já consegue escrever várias regras, mas o <strong>iptables</strong> fornece ainda mais opções. Para a lista completa, leia a página de manual (<em>man page</em>) do <strong>iptables</strong>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ man iptables
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ou, se preferir ler no navegador:</p>

<ul>
  <li><a href="https://linux.die.net/man/8/iptables">iptables(8) - Linux man page</a></li>
</ul>

<p>A seguinte lista de portas também pode ser útil enquanto estiver criando regras:</p>

<ul>
  <li><a href="https://pt.wikipedia.org/wiki/Lista_de_portas_dos_protocolos_TCP_e_UDP">Lista de portas dos protocolos TCP e UDP - Wikipédia</a></li>
</ul>

<h2 id="qual-é-a-diferença-entre-drop-e-reject">Qual é a diferença entre DROP e REJECT?</h2>

<p>A essa altura, você pode estar se perguntando: qual é a diferença entre <code class="highlighter-rouge">DROP</code> e <code class="highlighter-rouge">REJECT</code>?</p>

<p>A semelhança é que em ambos os <em>targets</em> o pacote é bloqueado (o <strong>iptables</strong> não deixa o pacote passar). A diferença vai além da tradução (aqui, estou usando “descartar” para <code class="highlighter-rouge">DROP</code> e “rejeitar” para <code class="highlighter-rouge">REJECT</code>). A diferença entre <code class="highlighter-rouge">DROP</code> e <code class="highlighter-rouge">REJECT</code> é que no caso do <code class="highlighter-rouge">DROP</code>, o pacote é silenciosamente descartado pelo <strong>iptables</strong>, que não envia uma resposta ao remetente (que “se sente” ignorado), já no caso do <code class="highlighter-rouge">REJECT</code>, o <strong>iptables</strong> descarta o pacote, mas também envia uma resposta ao remetente (que pode compreender que aquela requisição não é permitida).</p>

<p>Você pode ver a diferença entre <code class="highlighter-rouge">DROP</code> e <code class="highlighter-rouge">REJECT</code> esquematizada na figura do início do <em>post</em>.</p>

<p>Façamos um teste prático. Adicione a seguinte regra, usando <code class="highlighter-rouge">DROP</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables -A OUTPUT -d kamarada.github.io -j DROP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Agora tente acessar o <em>site</em> <a href="https://kamarada.github.io/">kamarada.github.io</a> usando o navegador (abra esse <em>link</em> em uma nova aba). Após muito tempo tentando conectar, o navegador informa que não foi possível acessar o <em>site</em> porque ele demorou muito para responder:</p>

<div class="image no-ads-here text-center mb-3" itemscope="" itemtype="http://schema.org/ImageObject">
<a href="/files/2019/11/iptables-drop-pt.jpg" title="">
<img src="/files/2019/11/iptables-drop-pt.jpg" alt="" class="img-fluid img-thumbnail" itemprop="contentUrl" />
</a>

</div>

<p>Exclua essa regra (para excluir apenas uma regra específica, você pode repeti-la trocando <code class="highlighter-rouge">-A</code> por <code class="highlighter-rouge">-D</code>) e adicione outra, usando <code class="highlighter-rouge">REJECT</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># iptables -D OUTPUT -d kamarada.github.io -j DROP
# iptables -A OUTPUT -d kamarada.github.io -j REJECT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Agora atualize aquela aba. O navegador responde de imediato, informando que a conexão foi <strong>recusada</strong>:</p>

<div class="image no-ads-here text-center mb-3" itemscope="" itemtype="http://schema.org/ImageObject">
<a href="/files/2019/11/iptables-reject-pt.jpg" title="">
<img src="/files/2019/11/iptables-reject-pt.jpg" alt="" class="img-fluid img-thumbnail" itemprop="contentUrl" />
</a>

</div>

<p>A depender da sua intenção, pode ser mais interessante usar um ou outro. Por exemplo, eu usaria o <code class="highlighter-rouge">REJECT</code> para bloquear o acesso a um <em>site</em> pela rede interna, porque para o usuário apareceria uma mensagem mais enfática, mas para bloquear um acesso indevido pelo mundo exterior eu usaria o <code class="highlighter-rouge">DROP</code>, porque um eventual atacante não receberia resposta e se sentiria “dando tiros no escuro”.</p>

<h2 id="salvando-e-restaurando-regras">Salvando e restaurando regras</h2>

<p>As regras do <strong>iptables</strong> são armazenadas no <em>kernel</em> e começam a ser aplicadas assim que os comandos são executados, mas são perdidas se o sistema é reiniciado.</p>

<p>Dois comandos que você pode usar para salvar e restaurar as regras são o <strong><a href="https://linux.die.net/man/8/iptables-save">iptables-save</a></strong> e o <strong><a href="https://linux.die.net/man/8/iptables-restore">iptables-restore</a></strong>, respectivamente.</p>

<p>Para salvar as regras atualmente em uso, execute:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables-save &gt; /caminho/nome_do_arquivo
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Para restaurar as regras de um arquivo criado anteriormente, execute:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># iptables-restore &lt; /caminho/nome_do_arquivo
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="levantando-o-firewall-com-shell-script">Levantando o firewall com shell script</h2>

<p>Embora os comandos <strong>iptables-save</strong> e <strong>iptables-restore</strong> sejam práticos, a forma mais comum de configurar o <strong>iptables</strong> (limpar as regras, definir a política padrão, adicionar regras) é criar um <em>shell script</em>. Fica mais legível e fácil de documentar e dar manutenção.</p>

<p>Por exemplo, crie um <em>script</em> <code class="highlighter-rouge">meu-firewall.sh</code> na pasta <code class="highlighter-rouge">/usr/local/sbin/</code> usando seu editor de texto preferido (vou usar o <strong><a href="https://www.nano-editor.org/">nano</a></strong>):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># nano /usr/local/sbin/meu-firewall.sh
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Copie e cole o seguinte conteúdo (<strong>dica:</strong> para colar no terminal, use <strong>Ctrl + Shift + V</strong>):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-ex</span>

<span class="c"># Limpar as regras</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-X</span>
iptables <span class="nt">-t</span> nat <span class="nt">-F</span>
iptables <span class="nt">-t</span> nat <span class="nt">-X</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-F</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-X</span>
iptables <span class="nt">-t</span> raw <span class="nt">-F</span>
iptables <span class="nt">-t</span> raw <span class="nt">-X</span>

<span class="c"># Politica padrao: bloquear todas as conexoes de entrada</span>
iptables <span class="nt">-P</span> FORWARD DROP
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> OUTPUT ACCEPT

<span class="c"># Aceitar conexoes estabelecidas previamente</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> state <span class="nt">--state</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT

<span class="c"># Aceitar tudo vindo da interface de loopback</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># ICMP (ping)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">-j</span> ACCEPT

<span class="c"># SSH (porta 22/TCP,UDP)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP (porta 80/TCP)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="alert alert-warning" role="alert">

<p>Esse <em>script</em> é um modelo bem simples, pensado para um servidor <em>web</em>. Lembre-se de adaptar os comandos conforme a sua necessidade.</p>

</div>

<p>Conceda permissão para executar o <em>script</em> apenas para o usuário <em>root</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># chmod 744 /usr/local/sbin/meu-firewall.sh
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Pronto! Agora, quando quiser levantar o <em>firewall</em>, é só chamar o <em>script</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># /usr/local/sbin/meu-firewall.sh
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Quando precisar mudar as regras do <em>firewall</em>, edite o <em>script</em> e execute-o de novo.</p>

<h2 id="levantando-o-firewall-no-boot">Levantando o firewall no boot</h2>

<p>Pro nosso <em>firewall</em> ficar perfeito, só falta um detalhe: as regras devem ser aplicadas já durante o <em>boot</em>, quando o sistema operacional, a rede e os serviços são iniciados.</p>

<p>Em distribuições com <strong><a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a></strong>, como é o caso do openSUSE e do Linux Kamarada, a melhor forma de executar um <em>script</em> como o <code class="highlighter-rouge">meu-firewall.sh</code> durante o <em>boot</em> é criar um serviço.</p>

<p>Por exemplo, crie um serviço do <strong>systemd</strong> chamado <code class="highlighter-rouge">meu-firewall.service</code> na pasta <code class="highlighter-rouge">/etc/systemd/system/</code> usando seu editor de texto preferido:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># nano /etc/systemd/system/meu-firewall.service
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Copie e cole o seguinte conteúdo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[Unit]
After=network.target

[Service]
ExecStart=/usr/local/sbin/meu-firewall.sh

[Install]
WantedBy=default.target
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ajuste as permissões do arquivo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre># chmod 664 /etc/systemd/system/meu-firewall.service
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Instale e habilite o serviço, para que ele seja iniciado no próximo <em>boot</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># systemctl daemon-reload
# systemctl enable meu-firewall
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Se quiser testar seu serviço antes de reiniciar, execute:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># systemctl start meu-firewall
# iptables -L
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Pronto! Da próxima vez em que você reiniciar o sistema, o <strong>systemd</strong> se encarregará de iniciar o serviço que executa o <em>script</em> que configura o <strong>iptables</strong>.</p>

<h2 id="referências">Referências</h2>

<p>Espero que esse texto tenha sido útil. Se você o leu todo até aqui, já dispõe de conhecimento suficiente para implantar o <strong>iptables</strong> em seus servidores. Se quiser saber mais, leia:</p>

<ul>
  <li><a href="https://guiafoca.org/cgs/guia/avancado/ch-fw-iptables.html">Guia Foca GNU/Linux - Firewall iptables</a></li>
  <li><a href="https://www.infowester.com/firewall.php">O que é firewall? - Conceito, tipos e arquiteturas - InfoWester</a></li>
  <li><a href="https://www.vivaolinux.com.br/artigo/IPTables-Desvendando-o-misterio">IPTables - Desvendando o mistério - Viva o Linux</a></li>
  <li><a href="https://linux.die.net/man/8/iptables">iptables(8) - Linux man page</a></li>
  <li><a href="https://www.suse.com/c/basic-iptables-tutorial/">Basic iptables Tutorial - SUSE Communities</a></li>
  <li><a href="https://www.cyberciti.biz/tips/howto-block-ipaddress-with-iptables-firewall.html">Linux Iptables block incoming access to selected or specific ip address - nixCraft</a></li>
  <li><a href="https://www.vivaolinux.com.br/dica/DROP-ou-REJECT-no-iptables">DROP ou REJECT no iptables? - Viva o Linux</a></li>
  <li><a href="https://linuxconfig.org/how-to-automatically-execute-shell-script-at-startup-boot-on-systemd-linux">How to automatically execute shell script at startup boot on systemd Linux - LinuxConfig.org</a></li>
</ul>


        </div>

        
            <!-- AddThis Sharing Buttons -->
            <div class="gap"></div>
            <h2>
                
                    Gostou? Que tal compartilhar?
                
            </h2>
            <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
                <a class="addthis_button_facebook"></a>
                <a class="addthis_button_twitter" data-via="LinuxKamarada"></a>
                <a class="addthis_button_google_plusone_share"></a>
                <a class="addthis_button_email"></a>
                <a class="addthis_button_favorites"></a>
                <a class="addthis addthis_button_print"></a>
                <a class="addthis_button_pdfonline"></a>
                <a class="addthis_button_compact"></a>
                <a class="addthis_counter addthis_bubble_style"></a>
            </div>
            <!-- AddThis Sharing Buttons End -->
        

        <div class="media my-4">
    <img class="mr-3" src="/assets/icons/other/coffee.svg" alt="Me paga um café?" style='max-width: 48px;'>
    <div class="media-body">
        Se você gostou muito, se foi muito útil pra você, será que vale um café? Se quiser, você pode "me pagar um café" pelo <a href="#" title="PayPal" target="_blank">PayPal</a> ou <a href="#">contribuir com o projeto de outras formas</a>.
    </div>
</div>


        
            
                <!-- Disqus -->
                <div class="gap"></div>
                <h2>
                    
                        Comentários
                    
                </h2>
                <div id="disqus_thread"></div>
                <script>
                    var disqus_config = function () {
                        
                            this.language = "pt";
                        
                        this.page.url = 'https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/';
                    };

                    (function() {
                        var d = document, s = d.createElement('script');

                        s.src = '//kamarada.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>
                    <p>Please <a href="http://www.enable-javascript.com/" target="_blank">enable JavaScript</a> to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.</p>
                </noscript>
                <!-- Disqus End -->
            
        
    </article>
</div><!-- .blog-post -->

                    </div>
                    <div class="col-sm-4">
                        <div class="card mb-3" id="about">
    <div class="card-header">
      <h3>
          <a name="about"></a>
          
              Sobre
          
      </h3>
    </div>
    <div class="card-body" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="Linux Kamarada" />
        <meta itemprop="url" content="https://kamarada.github.io" />
        <p class='text-center' itemprop='logo' itemscope itemtype='http://schema.org/ImageObject'>
            <a href='https://kamarada.github.io/assets/img/TuxKamarada.png' itemprop='url'>
                <img src='https://kamarada.github.io/assets/img/TuxKamarada.png' class='img-fluid rounded-circle'>
            </a>
            <!--<meta itemprop="width" content=""/>--><!-- TODO Image width -->
            <!--<meta itemprop="height" content=""/>--><!-- TODO Image height -->
        </p>
        <p class="text" itemprop="description">
            
                O Projeto Linux Kamarada visa divulgar e promover o Linux como um sistema operacional robusto, seguro, versátil e fácil de usar, adequado para o uso diário seja em casa, no trabalho ou no servidor. Os focos do projeto são principalmente distribuição e documentação.

            
        </p>
        
            <!-- AddThis Follow Buttons -->
            <div class="addthis_toolbox addthis_32x32_style addthis_default_style addthis_follow_buttons text-center">
                
                    <a href="https://facebook.com/LinuxKamarada" class="addthis_button_facebook_follow" addthis:userid="LinuxKamarada" itemprop="sameAs"></a>
                
                
                    <a href="https://twitter.com/LinuxKamarada" class="addthis_button_twitter_follow" addthis:userid="LinuxKamarada" itemprop="sameAs"></a>
                
                
                    <a href="https://instagram.com/Linux_Kamarada" class="addthis_button_instagram_follow" addthis:userid="Linux_Kamarada" itemprop="sameAs"></a>
                
                
                
                
                
                
                    <a href="https://github.com/LinuxKamaradaNoticias" class="addthis_button_telegram_follow" addthis:userid="LinuxKamaradaNoticias" itemprop="sameAs"></a>
                
                
                    <a href="https://github.com/kamarada" class="addthis_button_github_follow" addthis:userid="kamarada" itemprop="sameAs"></a>
                
                <a href="https://kamarada.github.io/pt/feed.xml" class="addthis_button_rss_follow"></a>
            </div>
            <!-- AddThis Follow Buttons End -->
        
    </div><!-- .card-body -->
</div><!-- .card -->


    <div class="card mb-3">
        <div class="card-body">
            
    <!-- Google AdSense -->
    <ins class="adsbygoogle" id="sidebar_ad_unit"
        style="display:block"
        data-ad-client="ca-pub-5193467168351289"
        data-ad-slot="7329324255"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <!-- End Google AdSense -->
    <div class="alert alert-danger please-allow-ads d-none" role="alert">
        <div class="media">
            <img class="mr-3" src="/assets/icons/other/detective_penguin.svg" alt="Detetive pinguim" style="max-width: 64px;">
            <div class="media-body">
                <h6 class="alert-heading mt-0">Cadê o anúncio que estava aqui?</h6>
                Parece que você está usando um bloqueador de anúncios. Mas dependemos deles para continuar criando conteúdo gratuito e de qualidade para você. Se você gosta do nosso conteúdo, por favor apoie nosso <em>site</em> desativando seu bloqueador de anúncios. Alternativamente, se você vem aqui com frequência, por favor considere <a href='/pt/contribuir'>fazer uma doação</a>.
            </div>
        </div>
    </div>


        </div><!-- .col-xs-12 -->
    </div><!-- .row -->


<div class="card mb-3" id="donate">
    <div class="card-header">
      <h3>
          <a name="donate"></a>
          Doações
      </h3>
    </div>
    <div class="card-body">
        

    <p>Você pode fazer uma doação única rapidamente usando o <a href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=J7F5GPWZX7CJA&no_shipping=1&currency_code=BRL&lc=BR' title='PayPal' target='_blank'>PayPal</a>:</p>
    <p class="text-center">
        <a href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=J7F5GPWZX7CJA&no_shipping=1&currency_code=BRL&lc=BR' title='PayPal' target='_blank'>
            <img src='https://kamarada.github.io/assets/img/paypal-pt.gif' alt='PayPal'>
        </a>
    </p>
    <!--<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" class="text-center">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="8VDPEA3ADF222" />
        <input type="hidden" name="business" value="linuxkamarada@gmail.com" />
        <input type="image" src="https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Faça doações com o botão do PayPal" />
        <img alt="" border="0" src="https://www.paypal.com/pt_BR/i/scr/pixel.gif" width="1" height="1" />
    </form>-->

    <p>Ou fazer doações mensais por meio de um desses serviços:</p>
    <div class="row text-center">
        <div class="col">
            <a href='https://www.padrim.com.br/LinuxKamarada' title='Padrim' target='_blank'>
                <p><img src='https://kamarada.github.io/assets/img/padrim.jpg' alt='Padrim' class='img-fluid img-thumbnail rounded-circle' style='width: 100px'></p>
                <p>Padrim</p>
            </a>
        </div>
        <div class="col">
            <a href='https://apoia.se/LinuxKamarada' title='APOIA.se' target='_blank'>
                <p><img src='https://kamarada.github.io/assets/img/apoiase.jpg' alt='APOIA.se' class='img-fluid img-thumbnail rounded-circle' style='width: 100px'></p>
                <p>APOIA.se</p>
            </a>
        </div>
    </div>

    <a href="/pt/contribuir">Mais informações e outras formas de contribuir ›</a>



    </div><!-- .card-body -->
</div><!-- .card -->


    <div class="card mb-3 d-none d-lg-block">
        <div class="card-header">
            <h3>
                Facebook
            </h3>
        </div>
        <div class="card-body">
            <div id="facebook-page-plugin-wrapper">
                <!-- Facebook Page Plugin -->
                <div class="fb-page" data-href="https://www.facebook.com/LinuxKamarada/" data-tabs="timeline" data-width="" data-height="450" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/LinuxKamarada/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/LinuxKamarada/">Linux Kamarada</a></blockquote></div>
            </div><!-- #facebook-page-plugin-wrapper -->
        </div><!-- .card-body -->
    </div><!-- .card -->



    
        <div class="card mb-3 d-none d-lg-block">
            <div class="card-header">
                <h3>
                    Twitter
                </h3>
            </div>
            <div class="card-body">
                <!-- Twitter Embedded Timeline -->
                <a class="twitter-timeline" data-height="450" data-theme="light" data-link-color="#4caf50" href="https://twitter.com/LinuxKamarada?ref_src=twsrc%5Etfw">Tweets by LinuxKamarada</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div><!-- .card-body -->
        </div><!-- .card -->
    


<div class="card mb-3">
    <div class="card-header">
        <h3>
            <a name="author"></a>
            
                Autor
            
        </h3>
    </div>
    <div class="card-body" itemprop="author" itemscope itemtype="http://schema.org/Person">
        
            <p class="text-center">
                <a href='https://secure.gravatar.com/avatar/5415f4267b44aa9f51b6f89ac4d1656b' title='Antônio Vinícius'>
                    <img src='https://secure.gravatar.com/avatar/5415f4267b44aa9f51b6f89ac4d1656b' alt='Antônio Vinícius' class='img-fluid img-thumbnail rounded-circle'>
                </a>
            </p>
        
        
            <p class="lead text-center" itemprop="name">
                
                    Antônio Vinícius
                
            </p>
        
        <ul class="contact-list list-unstyled">
            
                <li><a href="http://www.vinyanalista.com.br" itemprop="url"><i class="fas fa-globe"></i> http://www.vinyanalista.com.br</a></li>
            
        </ul>
    </div><!-- .card-body -->
</div><!-- .card -->

                    </div>
                </div>
            </div>

            <footer class="footer">
    <div class="container">
        Copyleft 2020 <a href='#author'>Antônio Vinícius</a>. Todos os direitos liberados. Baseado no <a href='https://github.com/vinyanalista/material-jekyll-plus'>Material site template for Jekyll PLUS</a>.
    </div>
</footer>

<meta itemprop="description" content="Faz tempo que não falamos de servidores… Hoje vamos falar sobre segurança focando em servidores, mas serve também para desktops, seja em casa ou no trabalho. A Internet facilitou bastante acessar, enviar e compartilhar informações. Mas, como diz o ditado, “não há bônus sem ônus”: junto das conveniências, a Internet trouxe também uma série de...">


    <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="https://kamarada.github.io/files/2019/11/iptables.jpg"/>
        <!--<meta itemprop="width" content=""/>--><!-- TODO Image width -->
        <!--<meta itemprop="height" content=""/>--><!-- TODO Image height -->
    </div>



    <meta itemprop="inLanguage" content="pt"/>



    
        <!-- Disqus -->
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES * * */
            
                var disqus_config = function () {
                    this.language = "pt";
                };
            
            var disqus_shortname = 'kamarada';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
            }());
        </script>
        <!-- Disqus End -->
    



    <!-- Google AdSense -->
    
        
    <!-- Google AdSense -->
    <ins class="adsbygoogle" id="content_ad_unit_2"
        style="display:block"
        data-ad-client="ca-pub-5193467168351289"
        data-ad-slot="4375857858"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <!-- End Google AdSense -->
    <div class="alert alert-danger please-allow-ads d-none" role="alert">
        <div class="media">
            <img class="mr-3" src="/assets/icons/other/detective_penguin.svg" alt="Detetive pinguim" style="max-width: 64px;">
            <div class="media-body">
                <h6 class="alert-heading mt-0">Cadê o anúncio que estava aqui?</h6>
                Parece que você está usando um bloqueador de anúncios. Mas dependemos deles para continuar criando conteúdo gratuito e de qualidade para você. Se você gosta do nosso conteúdo, por favor apoie nosso <em>site</em> desativando seu bloqueador de anúncios. Alternativamente, se você vem aqui com frequência, por favor considere <a href='/pt/contribuir'>fazer uma doação</a>.
            </div>
        </div>
    </div>


    

    <script type="text/javascript">
        adsbygoogle = window.adsbygoogle || [];

        $(document).ready(function(){
            
                var $ad = $('#content_ad_unit_2');
                var $please_allow_ads = $('#content_ad_unit_2 + .please-allow-ads');
                var $posts = $('.blog-post');
                if (($posts.length > 1) || ($('.blog-archive-title').length > 0)) {
                    // Post listing
                    var post;
                    if ($posts.length > 2) {
                        post = random_number(2, $posts.length);
                    } else {
                        post = 2;
                    }
                    $posts.eq(post - 1).find('.blog-post-content .row').after($ad);
                    $('#content_ad_unit_2').after($please_allow_ads);
                } else {
                    // Page or post
                    var $paragraphs = $('.blog-post-content p').filter(function() {
                        return ($(this).closest('.no-ads-here').length == 0);
                    });
                    if ($paragraphs.length > 0) {
                        var paragraph;
                        if ($paragraphs.length > 1) {
                            paragraph = random_number(1, $paragraphs.length);
                        } else {
                            paragraph = 1;
                        }
                        $paragraphs.eq(paragraph - 1).after($ad);
                        $('#content_ad_unit_2').after($please_allow_ads);
                    } else {
                        $ad.remove();
                        $please_allow_ads.remove();
                    }
                }
            
            if (window.canRunAds === undefined) {
                // Ad blocker detected
                $('.please-allow-ads').removeClass('d-none');
            } else {
                $('.adsbygoogle').each(function(index, element){
                    adsbygoogle.push({});
                });
            }
        });
    </script>
    <!-- Google AdSense End -->



            
        </main>
    </div><!-- .bmd-layout-container -->

    <div class="modal fade" id="language-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-globe-americas" aria-hidden="true"></i> Traduções</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="list-group list-group-flush bmd-list-group-sm">
                    
                    
                        <a href="#" class="list-group-item list-group-item-action disabled">English</a>
                        
                        
                            <a class="list-group-item list-group-item-action translation-en" href="https://kamarada.github.io/en/2019/11/24/protect-yourself-with-the-iptables-firewall/">This page in English</a>
                        
                        <a class="list-group-item list-group-item-action" href="https://kamarada.github.io/en/">English home page</a>
                    
                        <a href="#" class="list-group-item list-group-item-action disabled">Português</a>
                        
                        
                            <a class="list-group-item list-group-item-action translation-pt" href="https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/">Esta página em Português</a>
                        
                        <a class="list-group-item list-group-item-action" href="https://kamarada.github.io/pt/">Página inicial em Português</a>
                    
                    <a href="#" class="list-group-item list-group-item-action disabled">Other languages (by Google Translate)</a>
                    <a class="list-group-item list-group-item-action" href="http://translate.google.com/translate?js=n&sl=pt&u=https://kamarada.github.io/pt/2019/11/18/proteja-se-com-o-firewall-iptables/">Translate this page</a>
                </div>

            </div><!--.modal-body-->
        </div><!--.modal-content-->
    </div><!--.modal-dialog-->
</div><!--#language-modal-->

</body>
</html>
